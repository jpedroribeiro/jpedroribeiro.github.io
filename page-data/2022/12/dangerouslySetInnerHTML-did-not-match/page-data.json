{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022/12/dangerouslySetInnerHTML-did-not-match/","result":{"data":{"site":{"siteMetadata":{"title":"J. Pedro Ribeiro"}},"markdownRemark":{"id":"8212d582-8145-5b4e-8ce2-1d3872053d53","excerpt":"This is an issue I come across every once in a while and it always takes me a couple hours to figure it out. Replicating the issue Let's say you have a React.jsâ€¦","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 5.063291139240507%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAASklEQVR42mPwFRT87ygo8N8NiN2FBP/b83D/d+Ln+2/NxfnfT1QELOYiwP/fA0iDsKsg/38fEeH/9rw8YLXOfLxg2hMoZ8vN9R8AT0cbpEvxUP0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"console.log error message on a browser\"\n        title=\"\"\n        src=\"/static/3c441eebc083cbc4a1c9cf8f7fb6e4d8/f058b/console_log.png\"\n        srcset=\"/static/3c441eebc083cbc4a1c9cf8f7fb6e4d8/c26ae/console_log.png 158w,\n/static/3c441eebc083cbc4a1c9cf8f7fb6e4d8/6bdcf/console_log.png 315w,\n/static/3c441eebc083cbc4a1c9cf8f7fb6e4d8/f058b/console_log.png 630w,\n/static/3c441eebc083cbc4a1c9cf8f7fb6e4d8/4971b/console_log.png 784w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>This is an issue I come across every once in a while and it always takes me a couple hours to figure it out.</p>\n<h2>Replicating the issue</h2>\n<p>Let's say you have a <strong>React.js</strong> component that will render a paragraph of text coming from a <abbr title=\"Content Management System\">CMS</abbr> and that content can have HTML tags in it, like a <abbr title=\"What You See Is What You Get\">WYSIWYG</abbr> editor.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// MyTextComponent.js</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyTextComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">dangerouslySetInnerHTML</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>content <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// App.js</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyTextComponent</span></span> <span class=\"token attr-name\">content</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The browser renders what you expect:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 460px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.44303797468354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAt0lEQVR42q1RywqDMBD0/7/ISwWpqaSl4KEHoV8glYJizFOnyVKLVgseOrAMs5tdZjcR3hjHcRZLva4va3NE+DM+A7tOoKoe6HsJrTWU0uilgpQS1lrS0uvAyrPWBm3b0fvFwMl2XT+RZRyMnVGWdxTFjZgxTpymJ3B+RRwfkPlcnl+QJEeqTSdZrRySxljvyMFYg2EYyKEQgpyEfNO0tE3QIZxz2ytvHfgbe95EvxrnzdPP7xn6AtpJImbYCCyaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"browser rendering the component\"\n        title=\"\"\n        src=\"/static/f2ddd18c5c4ab3621796433a87cddff4/08a84/output.png\"\n        srcset=\"/static/f2ddd18c5c4ab3621796433a87cddff4/c26ae/output.png 158w,\n/static/f2ddd18c5c4ab3621796433a87cddff4/6bdcf/output.png 315w,\n/static/f2ddd18c5c4ab3621796433a87cddff4/08a84/output.png 460w\"\n        sizes=\"(max-width: 460px) 100vw, 460px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>However, there's that <strong>warning</strong> in the console that says:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Warning: Prop `dangerouslySetInnerHTML` did not match. Server: \"\" Client: \"&lt;p>This is my paragraph.&lt;/p>\" </code></pre></div>\n<p>If you're using <strong>Next.js</strong>, you will get a nicer error message:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.088607594936708%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgklEQVR42l3N6w6CMAwF4L3/KwKJGn8AgmxjN8fooRVU4pIvPemSU5WfI0LfwwwDpq7j+UAJAZQSi4d0mn8i72PAGjwWN0ONbYtLVeHKbk2De10jag1IQTxIliOf7Ny7hLwHvRLOT8lytWY3W5C1nJnROz39spA/LkZZQDmDSgGIvjYFCOiwsgbaEwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Next.js error message\"\n        title=\"\"\n        src=\"/static/ccea4b77a71db7c42b127db1afd17a98/f058b/next_js_error.png\"\n        srcset=\"/static/ccea4b77a71db7c42b127db1afd17a98/c26ae/next_js_error.png 158w,\n/static/ccea4b77a71db7c42b127db1afd17a98/6bdcf/next_js_error.png 315w,\n/static/ccea4b77a71db7c42b127db1afd17a98/f058b/next_js_error.png 630w,\n/static/ccea4b77a71db7c42b127db1afd17a98/40601/next_js_error.png 945w,\n/static/ccea4b77a71db7c42b127db1afd17a98/78612/next_js_error.png 1260w,\n/static/ccea4b77a71db7c42b127db1afd17a98/29114/next_js_error.png 1920w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2>What causes this warning?</h2>\n<p>On  my example, the content passed to the component was <code class=\"language-text\">&lt;p>This is my paragraph.&lt;/p></code> which would be fine considering that we are using <code class=\"language-text\">dangerouslySetInnerHTML</code> to render the content.</p>\n<p>However, the component is already wrapping the content in a <code class=\"language-text\">&lt;p></code> tag which, according to the <a href=\"https://html.spec.whatwg.org/multipage/dom.html#phrasing-content\">HTML Spec</a>, should only contain <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Content_categories#phrasing_content\">phrasing content</a>.</p>\n<p>The spec also <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/p#:~:text=Paragraphs%20are%20block%2Dlevel%20elements%2C%20and%20notably%20will%20automatically%20close%20if%20another\">says</a>:</p>\n<blockquote>\n<p>Paragraphs are block-level elements, and notably will automatically close if another</p>\n</blockquote>\n<p>Here is a CodePen that illustrates and replicates this condition more clearly:</p>\n<iframe height=\"300\" style=\"width: 100%;\" scrolling=\"no\" title=\"Invalid nested paragraph tags\" src=\"https://codepen.io/jpedroribeiro/embed/XWBXXPo?default-tab=html%2Cresult\" frameborder=\"no\" loading=\"lazy\" allowtransparency=\"true\" allowfullscreen=\"true\">\n  See the Pen <a href=\"https://codepen.io/jpedroribeiro/pen/XWBXXPo\">\n  Invalid nested paragraph tags</a> by Pedro Ribeiro (<a href=\"https://codepen.io/jpedroribeiro\">@jpedroribeiro</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.\n</iframe>\n<p>If you inspect the rendered paragraph, you will see the following:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 406px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.58227848101266%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBElEQVR42k1Q7U7DMAzckzQfTdI2XVZYJ8q6rWIt9GNDIAQSP0BCmpjE+7/AkaSr4MfJZ/tknz0T8yVM1YPHBmF6jXk1QGU3CAIGQkMPygQCwj2m2sQps6B8jFY3EzpDsq5hlgWy1RrZtoFa5FBRglBEEDIGDxWiOLU1DakSj0QbHwmT4EqDWY0fqEwOve1QNR2O/QGHbkCaGjw+vWBd7vD69o5yU+Hj8wttf8TpdEbbDvg+/6CuH5De7pHdP0MXdyCEOYdXNtlDLFaQWYE434Byu+1yqnPo4Lg70Tl13Ll3kXFp3Y3cO5SXH8Z5CV020HYjtaJJMIr/cvc71ydT/5/WDfwFLC2X3ed6O+4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"paragraph with invalid nested tags\"\n        title=\"\"\n        src=\"/static/52274ee28ab2ec77e2fefbd9a55a074a/e33ef/dom_tree.png\"\n        srcset=\"/static/52274ee28ab2ec77e2fefbd9a55a074a/c26ae/dom_tree.png 158w,\n/static/52274ee28ab2ec77e2fefbd9a55a074a/6bdcf/dom_tree.png 315w,\n/static/52274ee28ab2ec77e2fefbd9a55a074a/e33ef/dom_tree.png 406w\"\n        sizes=\"(max-width: 406px) 100vw, 406px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Which doesn't match what the server rendered <code class=\"language-text\">&lt;p>This is my paragraph.&lt;/p></code>.</p>\n<h2>How to fix it?</h2>\n<p>One solution is to change the wrapping element to a <code class=\"language-text\">&lt;div></code> instead of a <code class=\"language-text\">&lt;p></code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// MyTextComponent.js</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyTextComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">dangerouslySetInnerHTML</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>content <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>   </code></pre></div>\n<p>The main point is to ensure that the rendered content is valid HTML.</p>","frontmatter":{"title":"How to fix 'dangerouslySetInnerHTML did not match' error in React.js","date":"December 27, 2022"}}},"pageContext":{"slug":"/2022/12/dangerouslySetInnerHTML-did-not-match/","previous":{"fields":{"slug":"/2021/03/book-notes-8-why-we-sleep/"},"frontmatter":{"title":"Book Notes #8: Why We Sleep: The New Science of Sleep and Dreams","tags":["book notes","sleep","fasting","coffee"]}},"next":{"fields":{"slug":"/2023/01/event-target-vs-event-currenttarget/"},"frontmatter":{"title":"event.target vs event.currentTarget - What is the difference?","tags":["event","javascript"]}}}},"staticQueryHashes":["63159454","792910177"],"slicesMap":{}}