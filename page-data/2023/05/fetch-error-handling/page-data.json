{"componentChunkName":"component---src-templates-blog-post-js","path":"/2023/05/fetch-error-handling/","result":{"data":{"site":{"siteMetadata":{"title":"J. Pedro Ribeiro"}},"markdownRemark":{"id":"f70f99cb-1ad1-5b57-95d7-9d1efd7d31d7","excerpt":"Have you ever wrapped your  on a  block to catch 4xx and 5xx errors, and it didn't work? This happens to me more frequently than I would like to admit. The…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.58227848101266%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAArUlEQVR42o2Oyw6CMBQF+yvSUh6lFAqB8lADaFj4/99zvIASV+BiFqeZaS4bphlVe4NKDBKdHbI4tqwxzi9UrkMUa1RNj354QumtZ652eBiSY4X4hJAodYoxI18l63b00Zia3WHWWty7K6SU8H3/EC44TJqirRsIIVYK6rum3R1WFgUmeozCEOEJMghgtcY9z7dN1IYupP7rMM7pMk/g4vl/IURA/mcvrZCQP/0b87qWZRdtOQ4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"network output\"\n        title=\"\"\n        src=\"/static/5f61ec99b25e945d48d03ec6b86a0a3e/f058b/network.png\"\n        srcset=\"/static/5f61ec99b25e945d48d03ec6b86a0a3e/c26ae/network.png 158w,\n/static/5f61ec99b25e945d48d03ec6b86a0a3e/6bdcf/network.png 315w,\n/static/5f61ec99b25e945d48d03ec6b86a0a3e/f058b/network.png 630w,\n/static/5f61ec99b25e945d48d03ec6b86a0a3e/c1328/network.png 866w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Have you ever wrapped your <code class=\"language-text\">fetch</code> on a <code class=\"language-text\">try/catch</code> block to catch 4xx and 5xx errors, and it didn't work?</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://httpstat.us/500\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// This will never be called!</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>This happens to me more frequently than I would like to admit.</p>\n<p>The reason why it doesn't work is that <code class=\"language-text\">fetch</code> will only throw error if there is a <strong>network</strong> error (or something like <em>CORS</em>).\nA <strong>4xx</strong> or <strong>5xx</strong> is a server response and therefore not considered an error by <code class=\"language-text\">fetch</code>.</p>\n<p>So what you need to do is to check the <code class=\"language-text\">response.ok</code> property, which will be <code class=\"language-text\">true</code> if the response is <strong>200</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">let</span> response<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Change the ending of the url below to 200 for a success response</span>\n      response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://httpstat.us/400\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Carry on...</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"All good ✅\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token punctuation\">(</span>\n          <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error: Response status </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>response<span class=\"token punctuation\">.</span>status<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      \n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Handle error</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Logs \"Error: Response status 400\"</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Below is a working example on CodePen:</p>\n<iframe height=\"300\" style=\"width: 100%;\" scrolling=\"no\" title=\"Error Handling in Fetch\" src=\"https://codepen.io/jpedroribeiro/embed/PoygOZL?default-tab=js%2Cresult&theme-id=dark\" frameborder=\"no\" loading=\"lazy\" allowtransparency=\"true\" allowfullscreen=\"true\">\n  See the Pen <a href=\"https://codepen.io/jpedroribeiro/pen/PoygOZL\">\n  Error Handling in Fetch</a> by Pedro Ribeiro (<a href=\"https://codepen.io/jpedroribeiro\">@jpedroribeiro</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.\n</iframe>\n<p>And there you go. <br/>\nNow you know how to handle errors in <code class=\"language-text\">fetch</code>! <br/>\nOr, if you are like me, you'll be here next month looking for this post again.</p>","frontmatter":{"title":"Error Handling in Fetch","date":"May 27, 2023"}}},"pageContext":{"slug":"/2023/05/fetch-error-handling/","previous":{"fields":{"slug":"/2023/03/sliding-puzzle-game-in-javascript/"},"frontmatter":{"title":"Sliding Puzzle Game in JavaScript","tags":["game","javascript","puzzle","node"]}},"next":{"fields":{"slug":"/2024/10/event-target-vs-event-currenttarget/"},"frontmatter":{"title":"How to prevent a CSS Flex item from expanding beyond its parent","tags":["css","flex"]}}}},"staticQueryHashes":["63159454","792910177"],"slicesMap":{}}