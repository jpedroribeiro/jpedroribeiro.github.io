{"data":{"site":{"siteMetadata":{"title":"J. Pedro Ribeiro","author":"J. Pedro Ribeiro"}},"markdownRemark":{"id":"3d5a63a5-3516-5fe1-8612-333afdf4e211","excerpt":"In this article I’m going to show you how to automate your accessibility testing with just a little amount of JavaScript and a great library. A little…","html":"<p>In this article I’m going to show you how to automate your accessibility testing with just a little amount of JavaScript and a great library.</p>\n<h2>A little background</h2>\n<p>A while ago I was under the task of review the <strong>accessibility</strong> standards of the website we were working on. We were used to do this, roughly, twice a year. One engineer would get this <strong>ticket</strong>, run through the code base for obvious <strong>a11y</strong> (accessibility) issues, and would submit a <strong>pull request</strong> with the fixes.</p>\n<p>It was a <strong>manual job</strong> and the requirements would be very loose. An <code class=\"language-text\">alt</code> tag here, a <code class=\"language-text\">label</code> there. Nothing more than a few file changes.</p>\n<p>It’s valid to point out that, keeping a commercial site up to accessibility standards is not just a nice thing to do to your users but also it is the <a href=\"https://www.gov.uk/service-manual/helping-people-to-use-your-service/making-your-service-accessible-an-introduction\">law</a>.</p>\n<p>When you combine repetitive tasks with lack of time you get… <strong>automation</strong>. We engineers are <em>“lazy”</em> by nature and the idea of automating a tedious task is what makes our job exciting.</p>\n<h2>Accessibility tests automation = pa11y</h2>\n<p>When researching about tools I could use for this task I came across <a href=\"http://pa11y.org/\">Pa11y</a>, which includes not only the command line interface but also a dashboard, webservice and a CI.</p>\n<p>In this article I’m focusing on the JavaScript interface that Pa11y provides, letting us write node modules to achieve our automation. I’m also using the version 5.0 beta, in which makes use of headless Chrome in place of PhantomJS.</p>\n<h2>Installation and first steps</h2>\n<p>Go to your terminal and make sure your node version is at least 8: <code class=\"language-text\">$ node -v v8.9.4</code></p>\n<p>All good. Now we install pa11y@beta (version 5 will soon leave beta and become the master branch, but in the meantime we need to tag its beta branch): <code class=\"language-text\">$ npm install -g pa11y@beta</code></p>\n<p>The <code class=\"language-text\">-g</code> is optional, it means it’s a <em>global</em> install and makes it available throughout the system. If you need this just for one specific project, feel free to skip it.</p>\n<p>With the installation done, you can start using it’s command line interface straightaway: <code class=\"language-text\">$ pa11y http://www.google.com</code></p>\n<p>The output will be a list of accessibility issues found on that specific URL. Now let’s see how we can test multiple pages at the same time and generate reports.</p>\n<h2>Node.js to the rescue</h2>\n<p>Pa11y provides a <strong>JavaScript interface</strong> that lets us write node scripts to create automation. In its most basic form, you can replicate the example above this way:</p>\n<p>- In a file named a11y.js, type the following code:</p>\n<p>const pa11y = require(‘pa11y’);\npa11y(’<a href=\"http://www.google.com/&#x27;\">http://www.google.com/’</a>)\n.then((results) => {\nconsole.log(results);\n});</p>\n<p>- Now run it on your terminal <code class=\"language-text\">$ node a11y.js</code></p>\n<p>You will notice that, now, the output is in <strong>JSON</strong> format. You can change it to CSV, HTML, and other types by passing a <strong>configuration object</strong> which will see more details later on.</p>\n<p>Now let’s try testing multiple pages.</p>\n<h2>Testing multiple pages</h2>\n<p>const pa11y = require(‘pa11y’);\nconst urls = [\npa11y(’<a href=\"http://www.google.com&#x27;\">http://www.google.com’</a>),\npa11y(’<a href=\"http://www.bbc.co.uk&#x27;\">http://www.bbc.co.uk’</a>),\n// Add more pages here as needed\n];</p>\n<p>Promise.all(urls)\n.then(results => {\nconsole.log(results[0]); // Results for Google\nconsole.log(results[1]); // Results for BBC\n});</p>\n<p>You can cater for each page individually, or you could just <strong>loop through</strong> the <code class=\"language-text\">results</code> array.</p>\n<p>The console <strong>output</strong> can become overwhelming on some sites, so let’s output this results into a readable HTML with the help of <strong>reporters</strong>.</p>\n<h2>Reporters</h2>\n<p>As default, Pa11y comes with <strong>JSON</strong>, CSV and CLI reporters, but you can add <strong>HTML</strong> and TSV via additional packages. To enable HTML reporting you need to install another node module:</p>\n<p><code class=\"language-text\">$ npm install -g pa11y-reporter-html</code></p>\n<p>As before, the <code class=\"language-text\">-g</code> is optional. With that done, we need to change our code to the following:</p>\n<p>const pa11y = require(‘pa11y’);\nconst html = require(‘pa11y-reporter-html’);\nconst urls = [\npa11y(’<a href=\"http://www.google.com&#x27;\">http://www.google.com’</a>),\npa11y(’<a href=\"http://www.bbc.co.uk&#x27;\">http://www.bbc.co.uk’</a>)\n];</p>\n<p>Promise.all(urls)\n.then(results => {\nconst googleResults = html.results(results[0]);\nconst bbcResults = html.results(results[1]);</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">googleResults\n  .then(output =&gt; {\n    console.log(output)\n  });\n\nbbcResults\n  .then(output =&gt; {\n    console.log(output)\n  });</code></pre></div>\n<p>});</p>\n<p>If you run that, <code class=\"language-text\">$ node a11y.js</code> you will get the output of each test in HTML format. With that content in hands, you can always use it to save into a file using <code class=\"language-text\">fs.createWriteStream</code>.</p>\n<h2>Conclusion</h2>\n<p>With a very small script and the help of a great library like Pa11y, accessibility tests can easily be automated.</p>\n<p>You can always take a step further and try out their <a href=\"https://github.com/pa11y/pa11y-dashboard\">dashboard repository</a> if you like to have a more graphical interface, or use <a href=\"https://github.com/pa11y/pa11y-ci\">pa11y-ci</a>, for continuous integration.</p>","frontmatter":{"title":"Accessibility Tests with Pa11y & Node","date":"January 10, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2018/01/accessibility-tests-with-pa11y-node/","previous":{"fields":{"slug":"/2017/08/book-review-web-performance-in-action/"},"frontmatter":{"title":"Book Review: Web Performance In Action","tags":["book review","performance"]}},"next":{"fields":{"slug":"/2018/01/fun-with-browser-apis-media-stream-image-capture/"},"frontmatter":{"title":"Fun with Browser APIs: Media Stream Image Capture","tags":["image capture","api","stream","media","flash","feed","camera"]}}}}